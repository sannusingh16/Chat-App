(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{373:function(e,t,n){},374:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n(35),r=n.n(a),s=n(49),i=n(14),o=(n(207),n(16)),l=n(29),u=n(388),j=n(389),d=n(15),b=n(24),h=(n(208),n(210),n(375),b.a.initializeApp({apiKey:"AIzaSyDebc6rnTMyO4zVYhBIUV11q_L-46hINgo",authDomain:"chat-app-efe4f.firebaseapp.com",databaseURL:"https://chat-app-efe4f-default-rtdb.firebaseio.com",projectId:"chat-app-efe4f",storageBucket:"chat-app-efe4f.appspot.com",messagingSenderId:"101567791284",appId:"1:101567791284:web:873bcb4452a2e5c56957e1"})),f=h.auth(),O=h.database(),m=h.storage(),p=n(2),x={state:"offline",last_changed:b.a.database.ServerValue.TIMESTAMP},v={state:"online",last_changed:b.a.database.ServerValue.TIMESTAMP},g=Object(c.createContext)(),k=function(e){var t=e.children,n=Object(c.useState)(null),a=Object(d.a)(n,2),r=a[0],s=a[1],i=Object(c.useState)(!0),o=Object(d.a)(i,2),l=o[0],u=o[1];return Object(c.useEffect)((function(){var e,t,n=f.onAuthStateChanged((function(n){n?(t=O.ref("/status/".concat(n.uid)),(e=O.ref("/profiles/".concat(n.uid))).on("value",(function(e){var t=e.val(),c={name:t.name,createdAt:t.createdAt,avatar:t.avatar,uid:n.uid,email:n.email};s(c),u(!1)})),O.ref(".info/connected").on("value",(function(e){!1!==!!e.val()&&t.onDisconnect().set(x).then((function(){t.set(v)}))}))):(e&&e.off(),O.ref(".info/connected").off(),t&&t.off(),s(null),u(!1))}));return function(){n(),e&&e.off(),t&&t.off(),O.ref(".info/connected").off()}}),[]),Object(p.jsx)(g.Provider,{value:{profile:r,isloading:l},children:t})},w=function(){return Object(c.useContext)(g)},y=["children"],C=function(e){var t=e.children,n=Object(l.a)(e,y),c=w(),a=c.profile,r=c.isloading;return r&&!a?Object(p.jsx)(u.a,{children:Object(p.jsx)(j.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"fast"})}):a||r?Object(p.jsx)(i.b,Object(o.a)(Object(o.a)({},n),{},{children:t})):Object(p.jsx)(i.a,{to:"/signin"})},N=["children"],S=function(e){var t=e.children,n=Object(l.a)(e,N),c=w(),a=c.profile,r=c.isloading;return r&&!a?Object(p.jsx)(u.a,{children:Object(p.jsx)(j.a,{center:!0,vertical:!0,size:"md",content:"Loading",speed:"fast"})}):a&&!r?Object(p.jsx)(i.a,{to:"/"}):Object(p.jsx)(i.b,Object(o.a)(Object(o.a)({},n),{},{children:t}))},T=n(398),A=n(399),I=n(400),D=n(392),E=n(384),F=n(99),L=n(98),U=n(386),P=n(13),B=n.n(P),H=n(17),M=n(377),R=n(201),z=["initialvalue","onsave","label","placeholder","emptymsg","wrapperclass"],V=function(e){var t=e.initialvalue,n=e.onsave,a=e.label,r=void 0===a?null:a,s=e.placeholder,i=void 0===s?"Write the value":s,u=e.emptymsg,j=void 0===u?"Input is empty":u,b=e.wrapperclass,h=void 0===b?"":b,f=Object(l.a)(e,z),O=Object(c.useState)(t),m=Object(d.a)(O,2),x=m[0],v=m[1],g=Object(c.useState)(!1),k=Object(d.a)(g,2),w=k[0],y=k[1],C=Object(c.useCallback)((function(e){v(e)}),[]),N=Object(c.useCallback)((function(){y((function(e){return!e})),v(t)}),[t]),S=function(){var e=Object(H.a)(B.a.mark((function e(){var c;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===(c=x.trim())&&E.a.info(j),c===t){e.next=5;break}return e.next=5,n(c);case 5:y(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:h,children:[r,Object(p.jsxs)(M.a,{children:[Object(p.jsx)(R.a,Object(o.a)(Object(o.a)({},f),{},{placeholder:i,onChange:C,value:x,disabled:!w})),Object(p.jsx)(M.a.Button,{onClick:N,children:Object(p.jsx)(L.a,{icon:w?"close":"edit"})}),w&&Object(p.jsx)(M.a.Button,{onClick:S,children:Object(p.jsx)(L.a,{icon:"check"})})]})]})},q=n(41),W=n(390),_=function(){var e=Object(c.useState)({"google.com":f.currentUser.providerData.some((function(e){return"google.com"===e.providerId})),"facebook.com":f.currentUser.providerData.some((function(e){return"facebook.com"===e.providerId}))}),t=Object(d.a)(e,2),n=t[0],a=t[1],r=function(e,t){a((function(n){return Object(o.a)(Object(o.a)({},n),{},Object(q.a)({},e,t))}))},s=function(){var e=Object(H.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,1!==f.currentUser.providerData.length){e.next=3;break}throw new Error("You Cannot Disconnet from ".concat(t));case 3:return e.next=5,f.currentUser.unlink(t);case 5:r(t,!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),E.a.error(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(H.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.currentUser.linkWithPopup(t);case 3:E.a.success("connected with ".concat(t.providerId)),r(t.providerId,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),E.a.Error(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{children:[n["google.com"]&&Object(p.jsxs)(W.a,{color:"green",closable:!0,onClose:function(){s("google.com")},children:[Object(p.jsx)(L.a,{icon:"google"})," Connected"]}),n["facebook.com"]&&Object(p.jsxs)(W.a,{color:"blue",closable:!0,onClose:function(){s("facebook.com")},children:[Object(p.jsx)(L.a,{icon:"facebook"})," Connected"]}),Object(p.jsxs)("div",{className:"mt-2",children:[!n["google.com"]&&Object(p.jsxs)(F.a,{block:!0,color:"green",onClick:function(){i(new b.a.auth.GoogleAuthProvider)},children:[Object(p.jsx)(L.a,{icon:"google"})," Link to Google"]}),!n["facebook.com"]&&Object(p.jsxs)(F.a,{block:!0,color:"blue",onClick:function(){i(new b.a.auth.FacebookAuthProvider)},children:[Object(p.jsx)(L.a,{icon:"facebook"}),"  Link to facebook"]})]})]})},G=n(378),K=n(192),J=n.n(K),Y=n(391);function Q(e){var t=e.toUpperCase().split(" ");return t.length>1?t[0][0]+t[1][0]:t[0][0]}function X(e){return e?Object.keys(e).map((function(t){return Object(o.a)(Object(o.a)({},e[t]),{},{id:t})})):[]}function Z(e,t,n,c){return $.apply(this,arguments)}function $(){return($=Object(H.a)(B.a.mark((function e(t,n,c,a){var r,s,i,o,l,u,j;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r={})["/profiles/".concat(t,"/").concat(n)]=c,s=a.ref("/messages").orderByChild("/author/uid").equalTo(t).once("value"),i=a.ref("/rooms").orderByChild("/lastmessage/author/uid").equalTo(t).once("value"),e.next=6,Promise.all([s,i]);case 6:return o=e.sent,l=Object(d.a)(o,2),u=l[0],j=l[1],u.forEach((function(e){r["/messages/".concat(e.key,"/author/").concat(n)]=c})),j.forEach((function(e){r["/rooms/".concat(e.key,"/lastmessage/author/").concat(n)]=c})),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee=["name"],te=function(e){var t=e.name,n=Object(l.a)(e,ee);return Object(p.jsx)(Y.a,Object(o.a)(Object(o.a)({circle:!0},n),{},{children:Q(t)}))};function ne(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(c.useState)(e),n=Object(d.a)(t,2),a=n[0],r=n[1],s=Object(c.useCallback)((function(){return r(!0)}),[]),i=Object(c.useCallback)((function(){return r(!1)}),[]);return{isOpen:a,open:s,close:i}}var ce=function(e){var t=Object(c.useState)((function(){return window.matchMedia(e).matches})),n=Object(d.a)(t,2),a=n[0],r=n[1];return Object(c.useEffect)((function(){var t=window.matchMedia(e);r(t.matches);var n=function(e){return r(e.matches)};return t.addListener(n),function(){return t.removeListener(n)}}),[e]),a};var ae=["image/png","image/jpeg","image/jpg"],re=function(){var e=ne(),t=e.isOpen,n=e.open,a=e.close,r=Object(c.useState)(null),s=Object(d.a)(r,2),i=s[0],o=s[1],l=Object(c.useRef)(),u=w().profile,j=Object(c.useState)(!1),b=Object(d.a)(j,2),h=b[0],f=b[1],x=function(e){return new Promise((function(t,n){e.toBlob((function(e){e?t(e):n(new Error("file process error"))}))}))},v=function(){var e=Object(H.a)(B.a.mark((function e(){var t,n,c,r,s,i;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.current.getImageScaledToCanvas(),f(!0),e.prev=2,e.next=5,x(t);case 5:return n=e.sent,c=m.ref("/profiles/".concat(u.uid)).child("avatar"),e.next=9,c.put(n,{cacheControl:"public,max-age=".concat(259200)});case 9:return r=e.sent,e.next=12,r.ref.getDownloadURL();case 12:return s=e.sent,e.next=15,Z(u.uid,"avatar",s,O);case 15:i=e.sent,O.ref().update(i),E.a.info("updated avatar"),f(!1),a(),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(2),E.a.error(e.t0.message),f(!1);case 26:case"end":return e.stop()}}),e,null,[[2,22]])})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"mt-3 text-center",children:[Object(p.jsx)(te,{name:u.name,src:u.avatar,className:"width-200 height-200 img-fullsize font-huge"}),Object(p.jsxs)("div",{children:[Object(p.jsxs)("label",{htmlFor:"avatar-upload",className:"cursor-pointer d-block padded",children:["Select New avatar",Object(p.jsx)("input",{id:"avatar-upload",type:"file",className:"d-none",accept:".png,.jpeg,.jpg",onChange:function(e){var t=e.target.files;if(1===t.length){var c=t[0];!function(e){return ae.includes(e.type)}(c)?E.a.error("wrong file type ".concat(c.type),4e3):(o(c),n(),e.target.value=null)}}})]}),Object(p.jsxs)(G.a,{show:t,onHide:a,children:[Object(p.jsx)(G.a.Header,{children:Object(p.jsx)(G.a.Title,{children:"Adjust and upload new avatar"})}),Object(p.jsx)(G.a.Body,{children:Object(p.jsx)("div",{className:"d-flex justify-content-center align-items-center h-100",children:i&&Object(p.jsx)(J.a,{ref:l,image:i,width:200,height:200,border:10,borderRadius:100,rotate:0})})}),Object(p.jsx)(G.a.Footer,{children:Object(p.jsx)(F.a,{block:!0,appearance:"ghost",onClick:v,disabled:h,children:"upload the file"})})]})]})]})},se=function(e){var t=e.signOut,n=w().profile,c=function(){var e=Object(H.a)(B.a.mark((function e(t){var c;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z(n.uid,"name",t,O);case 3:c=e.sent,O.ref().update(c),E.a.success("Nickname updated",4e3),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),E.a.error(e.t0.msg,4e3);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(U.a.Header,{children:Object(p.jsx)(U.a.Title,{children:"Dashboard"})}),Object(p.jsxs)(U.a.Body,{children:[Object(p.jsxs)("h3",{children:[" Hey,",n.name," "]}),Object(p.jsx)(_,{}),Object(p.jsx)(D.a,{}),Object(p.jsx)(V,{name:"nickname",initialvalue:n.name,onsave:c,label:Object(p.jsx)("div",{className:"mb-2",children:"Nickname"})}),Object(p.jsx)(re,{})]}),Object(p.jsx)(U.a.Footer,{children:Object(p.jsx)(F.a,{block:!0,color:"red",onClick:t,children:"Sign Out"})})]})},ie=function(){var e=ne(),t=e.isOpen,n=e.close,a=e.open,r=ce("(max-width:992px)"),s=Object(c.useCallback)((function(){O.ref("/status/".concat(f.currentUser.uid)).set(x).then((function(){f.signOut(),E.a.info("SignedOut",4e3),n()})).catch((function(e){E.a.error(e.message)}))}),[n]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)(F.a,{block:!0,color:"red",onClick:a,children:[Object(p.jsx)(L.a,{icon:"dashboard"})," Dashboard"]}),Object(p.jsx)(U.a,{full:r,show:t,onHide:n,placement:"left",children:Object(p.jsx)(se,{signOut:s})})]})},oe=n(393),le=n(394),ue=n(379),je=n(395),de=n(385),be={name:"",description:""},he=oe.a.Types.StringType,fe=oe.a.Model({name:he().isRequired("Chat name is required"),description:he().isRequired("Description is required")}),Oe=function(){var e=ne(),t=e.isOpen,n=e.open,a=e.close,r=Object(c.useState)(be),s=Object(d.a)(r,2),i=s[0],l=s[1],u=Object(c.useState)(!1),j=Object(d.a)(u,2),h=j[0],m=j[1],x=Object(c.useRef)(),v=Object(c.useCallback)((function(e){l(e)}),[]),g=function(){var e=Object(H.a)(B.a.mark((function e(){var t;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.current.check()){e.next=2;break}return e.abrupt("return");case 2:return m(!0),t=Object(o.a)(Object(o.a)({},i),{},{CreatedAt:b.a.database.ServerValue.TIMESTAMP,admins:Object(q.a)({},f.currentUser.uid,!0)}),e.prev=4,e.next=7,O.ref("rooms").push(t);case 7:E.a.info("".concat(i.name," Created")),l(be),a(),m(!1),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),E.a.error(e.t0.message,4e3);case 16:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"mt-1",children:[Object(p.jsxs)(F.a,{block:!0,color:"blue",onClick:n,children:[Object(p.jsx)(L.a,{icon:"telegram"}),"  Create new chat room"]}),Object(p.jsxs)(G.a,{show:t,onHide:a,children:[Object(p.jsx)(G.a.Header,{children:Object(p.jsx)(G.a.Title,{children:"New Chat room"})}),Object(p.jsx)(G.a.Body,{children:Object(p.jsxs)(le.a,{fluid:!0,onChange:v,formValue:i,model:fe,ref:x,children:[Object(p.jsxs)(ue.a,{children:[Object(p.jsx)(je.a,{children:"Room Name"}),Object(p.jsx)(de.a,{name:"name",placeholder:"Enter chat room name..."})]}),Object(p.jsxs)(ue.a,{children:[Object(p.jsx)(je.a,{children:"Desciption"}),Object(p.jsx)(de.a,{componentClass:"textarea",rows:5,name:"description",placeholder:"Enter room Description..... "})]})]})}),Object(p.jsx)(G.a.Footer,{children:Object(p.jsx)(F.a,{block:!0,appearance:"primary",onClick:g,disabled:h,children:"Create new chat room"})})]})]})},me=n(382),pe=Object(c.createContext)(),xe=function(e){var t=e.children,n=Object(c.useState)(null),a=Object(d.a)(n,2),r=a[0],s=a[1];return Object(c.useEffect)((function(){var e=O.ref("rooms");return e.on("value",(function(e){var t=X(e.val());s(t)})),function(){e.off()}}),[]),Object(p.jsx)(pe.Provider,{value:r,children:t})},ve=function(){return Object(c.useContext)(pe)},ge=n(93),ke=function(e){var t=e.room,n=t.CreatedAt,c=t.name,a=t.lastmessage;return Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(p.jsx)("h3",{className:"text-disappear",children:c}),Object(p.jsx)(ge.a,{datetime:a?new Date(a.createdAt):new Date(n),className:"font-normal text-black-45"})]}),Object(p.jsx)("div",{className:"d-flex align-items-center text-black-70",children:a?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{className:"d-flex align-items-center",children:Object(p.jsx)(te,{src:a.author.avatar,name:a.author.name,size:"sm"})}),Object(p.jsxs)("div",{className:"text-disappear ml-2",children:[Object(p.jsx)("div",{className:"italic",children:a.author.name}),Object(p.jsx)("span",{children:a.text})]})]}):Object(p.jsx)("span",{children:"No messages yet ..."})})]})},we=function(e){var t=e.height,n=ve(),c=Object(i.g)();return Object(p.jsxs)(me.a,{appearance:"subtle",vertical:!0,reversed:!0,className:"overflow-y-scroll custom-scroll",style:{height:"calc(100% - ".concat(t,"px)")},activeKey:c.pathname,children:[!n&&Object(p.jsx)(j.a,{center:!0,vertical:!0,content:"loading",speed:"slow",size:"md"}),n&&n.length>0&&n.map((function(e){return Object(p.jsx)(me.a.Item,{componentClass:s.b,to:"/chat/".concat(e.id),eventKey:"/chat/".concat(e.id),children:Object(p.jsx)(ke,{room:e})},e.id)}))]})},ye=function(){var e=Object(c.useRef)(),t=Object(c.useState)(0),n=Object(d.a)(t,2),a=n[0],r=n[1];return Object(c.useEffect)((function(){e.current&&r(e.current.scrollHeight)}),[e]),Object(p.jsxs)("div",{className:"h-100 pt-2",children:[Object(p.jsxs)("div",{ref:e,children:[Object(p.jsx)(ie,{}),Object(p.jsx)(Oe,{}),Object(p.jsx)(D.a,{children:"Join Conversation"})]}),Object(p.jsx)(we,{height:a})]})},Ce=n(396),Ne=n(137),Se=Object(Ne.a)(),Te=function(e){var t=e.children,n=e.DATa;return Object(p.jsx)(Se.Provider,{value:n,children:t})},Ae=function(e){return Object(Ne.b)(Se,e)},Ie=function(){var e=ne(),t=e.open,n=e.close,c=e.isOpen,a=Object(i.h)().chatId,r=Ae((function(e){return e.name})),s=Ae((function(e){return e.description})),o=ce("(max-width:992px)"),l=function(e,t){O.ref("/rooms/".concat(a)).child(e).set(t).then((function(){E.a.success("updated succesfully",4e3)})).catch((function(e){E.a.error(e.message,4e3)}))};return Object(p.jsxs)("div",{children:[Object(p.jsx)(F.a,{className:"br-circle",size:"sm",color:"red",onClick:t,children:"A"}),Object(p.jsxs)(U.a,{full:o,show:c,onHide:n,placement:"right",children:[Object(p.jsx)(U.a.Header,{children:Object(p.jsx)(U.a.Title,{children:"Edit Room"})}),Object(p.jsxs)(U.a.Body,{children:[Object(p.jsx)(V,{initialvalue:r,onsave:function(e){l("name",e)},label:Object(p.jsx)("h6",{className:"mb-2",children:"Name"}),emptymsg:"name is empty"}),Object(p.jsx)(V,{componentClass:"textarea",rows:5,initialvalue:s,onsave:function(e){l("description",e)},emptymsg:"Description is empty",wrapperclass:"mt-3"})]}),Object(p.jsx)(U.a.Footer,{children:Object(p.jsx)(F.a,{block:!0,onClick:n,color:"blue",placement:"right",children:"close"})})]})]})},De=function(){var e=Ae((function(e){return e.description})),t=Ae((function(e){return e.name})),n=ne(),c=n.isOpen,a=n.open,r=n.close;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(F.a,{appearance:"link",className:"px-0",onClick:a,children:"Room information"}),Object(p.jsxs)(G.a,{show:c,onHide:r,children:[Object(p.jsx)(G.a.Header,{children:Object(p.jsxs)(G.a.Title,{children:["About ",t," "]})}),Object(p.jsxs)(G.a.Body,{children:[Object(p.jsx)("h6",{className:"mb-1",children:"Description"}),Object(p.jsx)("p",{children:e})]}),Object(p.jsx)(G.a.Footer,{children:Object(p.jsx)(F.a,{block:!0,onClick:r,color:"blue",children:"Close"})})]})]})},Ee=Object(c.memo)(De),Fe=function(){var e=Ae((function(e){return e.name})),t=Ae((function(e){return e.isAdmin})),n=ce("(max-width:992px)");return Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(p.jsxs)("h4",{className:"text-disappear d-flex align-item-center",children:[Object(p.jsx)(L.a,{componentClass:s.b,to:"/",icon:"arrow-circle-left",size:"2x",className:n?"d-inline-block p-0 mr-2 text-blue link-unstyled":"d-none"}),Object(p.jsx)("span",{className:"text-disappear",children:e})]}),t&&Object(p.jsx)(Ce.a,{className:"ws-nowrap",children:Object(p.jsx)(Ie,{})})]}),Object(p.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(p.jsx)("span",{children:"todo"}),Object(p.jsx)(Ee,{})]})]})},Le=Object(c.memo)(Fe),Ue=["profile","children"],Pe=function(e){var t=e.profile,n=e.children,c=Object(l.a)(e,Ue),a=ne(),r=a.isOpen,s=a.close,i=a.open,u=t.name,j=t.avatar,d=t.createdAt,b=t.name.split(" ")[0],h=new Date(d).toLocaleDateString();return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(F.a,Object(o.a)(Object(o.a)({},c),{},{onClick:i,children:b})),Object(p.jsxs)(G.a,{show:r,onHide:s,children:[Object(p.jsx)(G.a.Header,{children:Object(p.jsxs)(G.a.Title,{children:[b," profile"]})}),Object(p.jsxs)(G.a.Body,{className:"text-center",children:[Object(p.jsx)(te,{src:j,name:u,className:"width-200 height-200 img-fullsize font-huge"}),Object(p.jsx)("h4",{className:"mt-2",children:u}),Object(p.jsxs)("p",{children:["Member since ",h]})]}),Object(p.jsxs)(G.a.Footer,{children:[n,Object(p.jsx)(F.a,{block:!0,onClick:s,children:"Close"})]})]})]})},Be=n(196),He=n(203),Me=n(397),Re=function(e){if(!e)return"gray";switch(e.state){case"online":return"green";case"offline":return"red";default:return"gray"}},ze=function(e){return e?"online"===e.state?"online":"Last online ".concat(new Date(e.last_changed).toLocaleDateString()):"unknown-state"},Ve=function(e){var t=function(e){var t=Object(c.useState)(null),n=Object(d.a)(t,2),a=n[0],r=n[1];return Object(c.useEffect)((function(){var t=O.ref("/status/".concat(e));return t.on("value",(function(e){if(e.exists){var t=e.val();r(t)}})),function(){t.off()}}),[e]),a}(e.uid);return Object(p.jsx)(Be.a,{placement:"top",trigger:"hover",speaker:Object(p.jsx)(He.a,{children:ze(t)}),children:Object(p.jsx)(Me.a,{className:"cursor-pointor",style:{backgroundColor:Re(t)}})})},qe=n(202),We=["isvisible","iconname","tooltip","badgecontent","onClick"],_e=function(e){var t=e.condition,n=e.children;return t?Object(p.jsx)(Me.a,{content:t,children:n}):n},Ge=function(e){var t=e.isvisible,n=e.iconname,c=e.tooltip,a=e.badgecontent,r=e.onClick,s=Object(l.a)(e,We);return Object(p.jsx)("div",{className:"ml-2",style:{visibility:t?"visible":"hidden"},children:Object(p.jsx)(_e,{condition:a,children:Object(p.jsx)(Be.a,{placement:"top",delay:0,delayHide:0,delayShow:0,trigger:"hover",speaker:Object(p.jsx)("tooltip",{children:c}),children:Object(p.jsx)(qe.a,Object(o.a)(Object(o.a)({},s),{},{onClick:r,circle:!0,size:"xs",icon:Object(p.jsx)(L.a,{icon:n})}))})})})},Ke=function(e){var t=e.src,n=e.fileName,c=ne(),a=c.isOpen,r=c.open,s=c.close;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("input",{type:"image",src:t,alt:"file",onClick:r,className:"mw-100 mh-100 w-auto"}),Object(p.jsxs)(G.a,{show:a,onHide:s,children:[Object(p.jsx)(G.a.Header,{children:Object(p.jsx)(G.a.Title,{children:n})}),Object(p.jsx)(G.a.Body,{children:Object(p.jsx)("div",{children:Object(p.jsx)("img",{src:t,height:"100%",width:"100%",alt:"file"})})}),Object(p.jsx)(G.a.Footer,{children:Object(p.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:"View original"})})]})]})},Je=function(e){return e.contentType.includes("image")?Object(p.jsx)("div",{className:"height-220",children:Object(p.jsx)(Ke,{src:e.url,fileName:e.name})}):e.contentType.includes("audio")?Object(p.jsxs)("audio",{controls:!0,children:[Object(p.jsx)("source",{src:e.url,type:"audio/mp3"}),"Your browser does not support the audio element."]}):Object(p.jsxs)("a",{href:e.url,children:["Download ",e.name]})},Ye=function(e){var t=e.message,n=e.handleadmin,a=e.handleClick,r=e.handledelete,s=t.author,i=t.createdAt,l=t.text,u=t.likes,j=t.Likecount,b=t.file,h=function(){var e=Object(c.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1],r=Object(c.useRef)(null),s=function(){return a(!0)},i=function(){return a(!1)};return Object(c.useEffect)((function(){var e=r.current;return e&&(e.addEventListener("mouseover",s),e.addEventListener("mouseout",i)),function(){e.removeEventListener("mouseover",s),e.removeEventListener("mouseout",i)}}),[r.current]),[r,n]}(),O=Object(d.a)(h,2),m=O[0],x=O[1],v=ce("(max-width:992px)"),g=Ae((function(e){return e.isAdmin})),k=x||v,w=Ae((function(e){return e.admins})).includes(s.uid),y=f.currentUser.uid===s.uid,C=g&&!y,N=u&&Object.keys(u).includes(f.currentUser.uid);return Object(p.jsxs)("li",{className:"padded mb-1 cursor-pointer ".concat(x?"bg-black-02":""),ref:m,children:[Object(p.jsxs)("div",{className:"d-flex align-items-center font-bolder mb-1",children:[Object(p.jsx)(Ve,{uid:s.uid}),Object(p.jsx)(te,{src:s.avatar,name:s.name,className:"ml-1",size:"xs"}),Object(p.jsx)(Pe,{profile:s,appearance:"link",className:"p-0 ml-1 text-black",children:C&&Object(p.jsx)(F.a,{block:!0,onClick:function(){return n(s.uid)},color:"blue",children:w?"Remove Admin":"Add admin"})}),Object(p.jsx)(ge.a,{datetime:i,className:"font-normal ml-1 text-black-45"}),Object(p.jsx)(Ge,Object(o.a)(Object(o.a)({},N?{color:"red"}:{}),{},{isvisible:k,iconname:"heart",tooltip:"Like the message",badgecontent:j,onClick:function(){return a(t.id)}})),y&&Object(p.jsx)(Ge,{isvisible:k,iconname:"close",tooltip:"Delete the message",onClick:function(){return r(t.id,b)}})]}),Object(p.jsx)("div",{className:"word-break-all",children:l}),b&&Je(b)]})},Qe=Object(c.memo)(Ye),Xe=function(){var e=Object(c.useState)(null),t=Object(d.a)(e,2),n=t[0],a=t[1],r=Object(i.h)().chatId,s=n&&0===n.length,l=n&&n.length>0;Object(c.useEffect)((function(){var e=O.ref("/messages");return e.orderByChild("roomId").equalTo(r).on("value",(function(e){var t=X(e.val());a(t)})),function(){e.off()}}),[r]);var u=Object(c.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t){var n,c;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O.ref("/rooms/".concat(r,"/admins")),e.next=3,n.transaction((function(e){return e&&(e[t]?(e[t]=null,c="Admin permission removed"):(e[t]=!0,c="Admin permission grandted")),e}));case 3:E.a.info(c,4e3);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r]),j=Object(c.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t){var n,c,a;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=f.currentUser.uid,a=O.ref("/messages/".concat(t)),e.next=4,a.transaction((function(e){return e&&(e.likes&&e.likes[c]?(e.Likecount-=1,e.likes[c]=null,n="like removed"):(e.Likecount+=1,e.likes||(e.likes={}),e.likes[c]=!0,n="liked")),e}));case 4:E.a.info(n,4e3);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),b=Object(c.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t,c){var a,s,i;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Confirm to delete message")){e.next=2;break}return e.abrupt("return");case 2:a=n[n.length-1].id===t,(s={})["/messages/".concat(t)]=null,a&&n.length>1&&(s["/rooms/".concat(r,"/lastmessage")]=Object(o.a)(Object(o.a)({},n[n.length-2]),{},{msgId:n[n.length-2].id})),a&&1===n.length&&(s["/rooms/".concat(r,"/lastmessage")]=null);try{O.ref().update(s),E.a.info("Message deleted")}catch(l){E.a.error(l.msg,4e3)}if(!c){e.next=18;break}return e.prev=9,i=m.refFromURL(c.url),e.next=13,i.delete();case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(9),E.a.error(e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[9,15]])})));return function(t,n){return e.apply(this,arguments)}}(),[r,n]);return Object(p.jsxs)("ul",{className:"msg-list custom-scroll",children:[s&&Object(p.jsx)("li",{children:"Chat is empty"}),l&&n.map((function(e){return Object(p.jsx)(Qe,{message:e,handleadmin:u,handleClick:j,handledelete:b},e.id)}))]})},Ze=n(383),$e=function(e){var t=e.afterUpload,n=Object(i.h)().chatId,a=ne(),r=a.isOpen,s=a.close,o=a.open,l=Object(c.useState)([]),u=Object(d.a)(l,2),j=u[0],b=u[1],h=Object(c.useState)(!1),f=Object(d.a)(h,2),O=f[0],x=f[1],v=function(){var e=Object(H.a)(B.a.mark((function e(){var c,a,r,i;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=j.map((function(e){return m.ref("/chat/".concat(n)).child(Date.now()+e.name).put(e.blobFile,{cacheControl:"public, max-age=".concat(259200)})})),e.next=4,Promise.all(c);case 4:return a=e.sent,r=a.map(function(){var e=Object(H.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.metadata.contentType,e.t1=t.metadata.name,e.next=4,t.ref.getDownloadURL();case 4:return e.t2=e.sent,e.abrupt("return",{contentType:e.t0,name:e.t1,url:e.t2});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=8,Promise.all(r);case 8:return i=e.sent,e.next=11,t(i);case 11:x(!1),s(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),x(!1),E.a.error(e.t0.message);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(M.a.Button,{onClick:o,children:Object(p.jsx)(L.a,{icon:"attachment"})}),Object(p.jsxs)(G.a,{show:r,onHide:s,children:[Object(p.jsx)(G.a.Header,{children:Object(p.jsx)(G.a.Title,{children:"Upload files"})}),Object(p.jsx)(G.a.Body,{children:Object(p.jsx)(Ze.a,{autoUpload:!1,action:"",fileList:j,onChange:function(e){var t=e.filter((function(e){return e.blobFile.size<=512e4})).slice(0,5);b(t)},multiple:!0,listType:"picture-text",className:"w-100",disabled:O})}),Object(p.jsxs)(G.a.Footer,{children:[Object(p.jsx)(F.a,{block:!0,disabled:O,onClick:v,children:"Send to chat"}),Object(p.jsx)("div",{className:"text-right mt-2",children:Object(p.jsx)("small",{children:"* only files less than 5 mb are allowed"})})]})]})]})},et=n(199),tt=function(e){var t=e.afterUpload,n=Object(i.h)().chatId,a=Object(c.useState)(!1),r=Object(d.a)(a,2),s=r[0],o=r[1],l=Object(c.useState)(!1),u=Object(d.a)(l,2),j=u[0],b=u[1],h=Object(c.useCallback)((function(){o((function(e){return!e}))}),[]),f=Object(c.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(c){var a,r;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,e.next=4,m.ref("/chat/".concat(n)).child("audio_".concat(Date.now(),".mp3")).put(c.blob,{cacheControl:"public, max-age=".concat(259200)});case 4:return a=e.sent,e.t0=a.metadata.contentType,e.t1=a.metadata.name,e.next=9,a.ref.getDownloadURL();case 9:e.t2=e.sent,r={contentType:e.t0,name:e.t1,url:e.t2},t([r]),b(!1),e.next=19;break;case 15:e.prev=15,e.t3=e.catch(1),b(!1),E.a.error(e.t3.message);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}(),[t,n]);return Object(p.jsxs)(M.a.Button,{onClick:h,disabled:j,className:s?"animate-blink":"",children:[Object(p.jsx)(L.a,{icon:"microphone"}),Object(p.jsx)(et.ReactMic,{record:s,className:"d-none",onStop:f,mimeType:"audio/mp3"})]})};function nt(e,t){return{roomId:t,author:Object(o.a)({name:e.name,uid:e.uid,createdAt:e.createdAt},e.avatar?{avatar:e.avatar}:{}),createdAt:b.a.database.ServerValue.TIMESTAMP,Likecount:0}}var ct=function(){var e=Object(c.useState)(""),t=Object(d.a)(e,2),n=t[0],a=t[1],r=w().profile,s=Object(i.h)().chatId,l=Object(c.useState)(!1),u=Object(d.a)(l,2),j=u[0],b=u[1],h=Object(c.useCallback)((function(e){a(e)}),[]),f=function(){var e=Object(H.a)(B.a.mark((function e(){var t,c,i;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==n.trim()){e.next=2;break}return e.abrupt("return");case 2:return(t=nt(r,s)).text=n,c={},i=O.ref("messages").push().key,c["/messages/".concat(i)]=t,c["/rooms/".concat(s,"/lastmessage")]=Object(o.a)(Object(o.a)({},t),{},{msgId:i}),b(!0),e.prev=9,e.next=12,O.ref().update(c);case 12:a(""),b(!1),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),E.a.error(e.t0.messgage),b(!1);case 20:case"end":return e.stop()}}),e,null,[[9,16]])})));return function(){return e.apply(this,arguments)}}(),m=Object(c.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t){var n,c;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),n={},t.forEach((function(e){var t=nt(r,s);t.file=e;var c=O.ref("messages").push().key;n["/messages/".concat(c)]=t})),c=Object.keys(n).pop(),n["/rooms/".concat(s,"/lastMessage")]=Object(o.a)(Object(o.a)({},n[c]),{},{msgId:c}),e.prev=5,e.next=8,O.ref().update(n);case 8:b(!1),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),b(!1),E.a.error(e.t0.message);case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}(),[s,r]);return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)(M.a,{children:[Object(p.jsx)($e,{afterUpload:m}),Object(p.jsx)(tt,{afterUpload:m}),Object(p.jsx)(R.a,{placeholder:"Write your messages...",value:n,onChange:h,onKeyDown:function(e){13===e.keyCode&&(e.preventDefault(),f())}}),Object(p.jsx)(M.a.Button,{appearance:"primary",color:"blue",onClick:f,disabled:j,children:Object(p.jsx)(L.a,{icon:"send"})})]})})},at=function(){var e=Object(i.h)().chatId,t=ve();if(!t)return Object(p.jsx)(j.a,{center:!0,vertical:!0,size:"md",content:"loading",speed:"slow"});var n=t.find((function(t){return t.id===e}));if(!n)return Object(p.jsxs)("h6",{className:"text-center mt-page",children:["chat ",e," not found"]});var c,a=n.name,r=n.description,s=(c=n.admins)?Object.keys(c):[],o=s.includes(f.currentUser.uid),l={name:a,description:r,admins:s,isAdmin:o};return Object(p.jsxs)(Te,{DATa:l,children:[Object(p.jsx)("div",{className:"chat-top",children:Object(p.jsx)(Le,{})}),Object(p.jsx)("div",{className:"chat-middle",children:Object(p.jsx)(Xe,{})}),Object(p.jsx)("div",{className:"chat-bottom",children:Object(p.jsx)(ct,{})})]})},rt=function(){var e=ce("(min-width: 992px)"),t=Object(i.i)().isExact,n=e||t;return Object(p.jsx)(xe,{children:Object(p.jsx)(T.a,{fluid:!0,className:"h-100",children:Object(p.jsxs)(A.a,{className:"h-100",children:[n&&Object(p.jsx)(I.a,{className:"h-100",xs:24,md:8,children:Object(p.jsx)(ye,{})}),Object(p.jsxs)(i.d,{children:[Object(p.jsx)(i.b,{exact:!0,path:"/chat/:chatId",children:Object(p.jsx)(I.a,{xs:24,md:16,className:"h-100",children:Object(p.jsx)(at,{})})}),Object(p.jsx)(i.b,{children:e&&Object(p.jsx)(I.a,{xs:24,md:16,className:"h-100",children:Object(p.jsx)("h6",{className:"text-center mt-page",children:" Please Select chat "})})})]})]})})})},st=n(387),it=function(){var e=function(){var e=Object(H.a)(B.a.mark((function e(t){var n,c,a;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.signInWithPopup(t);case 3:if(n=e.sent,c=n.additionalUserInfo,a=n.user,!c.isNewUser){e.next=9;break}return e.next=9,O.ref("/profiles/".concat(a.uid)).set({name:a.displayName,createdAt:b.a.database.ServerValue.TIMESTAMP});case 9:E.a.success("Signed in",4e3),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),E.a.error(e.t0.message,4e3);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)(u.a,{children:Object(p.jsx)(T.a,{className:"mt-page",children:Object(p.jsx)(A.a,{children:Object(p.jsx)(I.a,{xs:24,md:12,mdOffset:6,children:Object(p.jsxs)(st.a,{children:[Object(p.jsxs)("div",{className:"text-center",children:[Object(p.jsx)("h2",{children:"Welcome To Chat"}),Object(p.jsx)("p",{children:"Progressive chat platform for neophytes"})]}),Object(p.jsxs)("div",{className:"mt-3",children:[Object(p.jsxs)(F.a,{block:!0,color:"blue",onClick:function(){e(new b.a.auth.FacebookAuthProvider)},children:[Object(p.jsx)(L.a,{icon:"facebook"})," Continue With Facebook "]}),Object(p.jsxs)(F.a,{block:!0,color:"green",onClick:function(){e(new b.a.auth.GoogleAuthProvider)},children:[Object(p.jsx)(L.a,{icon:"google"}),"  Continue With Google "]})]})]})})})})})};n(373);var ot=function(){return Object(p.jsx)(k,{children:Object(p.jsxs)(i.d,{children:[Object(p.jsx)(S,{path:"/signin",children:Object(p.jsx)(it,{})}),Object(p.jsx)(C,{path:"/",children:Object(p.jsx)(rt,{})})]})})},lt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,401)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),r(e),s(e)}))};r.a.render(Object(p.jsx)(s.a,{children:Object(p.jsx)(ot,{})}),document.getElementById("root")),lt()}},[[374,1,2]]]);
//# sourceMappingURL=main.bfa344e8.chunk.js.map